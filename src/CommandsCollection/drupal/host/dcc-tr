#!/bin/bash

############################
# DDEV Commands Collection #
############################

## https://github.com/jackd248/ddev-commands-collection
## v0.2.8
## dcc-autogenerated
. "$(dirname "$0")/../dcc-config.sh"
. "$(dirname "$0")/../scripts/dcc-colors.sh"
printf "${reset}${cyan}[DCC]${reset} DDEV Commands Collection\n"

## Description: Reset the local installation to the default db and config state
## Usage: tr
## Example: "ddev tr"
echo
echo -e "${magenta}[CONFIG]${reset}"
read -p $"Sync database? (y|N) " SYNC_DB

echo -e "${blue}[INFO]${reset} Install deployment composer dependencies"
ddev composer:deployment install -d ${composerPathDeployment}

echo -e "${blue}[INFO]${reset} Install app composer dependencies"
ddev composer:app install -d ${composerPathApp}

if [[ $SYNC_DB =~ ^[Yy]$ ]]
then
  echo -e "${blue}[INFO]${reset} Sync master database into local database"
  ddev auth ssh
  ddev sync
fi

echo -e "${blue}[INFO]${reset} Drush magic"
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cache-rebuild${reset}\n"
ddev drush cache-rebuild
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush updb -y${reset}\n"
ddev drush updb -y
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cim -y${reset}\n"
ddev drush cim -y
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cache-rebuild${reset}\n"
ddev drush cache-rebuild

echo
echo -e "${green}Drupal instance successfully reset.${reset}"
