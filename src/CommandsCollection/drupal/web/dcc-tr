#!/bin/bash

############################
# DDEV Commands Collection #
############################

## https://github.com/jackd248/ddev-commands-collection
## v<version/>
## dcc-autogenerated
. "$(dirname "$0")/../dcc-config.sh"
. "$(dirname "$0")/../scripts/dcc-colors.sh"
printf "${reset}${cyan}[DCC]${reset} DDEV Commands Collection\n"

## Description: Run tabula rasa command inside the web container
## Usage: tr
## Example: "ddev tr"
echo
echo -e "${magenta}[CONFIG]${reset}"
read -p $"Sync database? (y|N) " SYNC_DB

echo -e "${blue}[INFO]${reset} Install deployment composer dependencies"
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}composer install -d ${composerPathDeployment}${reset}\n"
composer install -d ${composerPathDeployment}

echo -e "${blue}[INFO]${reset} Install app composer dependencies"
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}composer install -d ${composerPathApp}${reset}\n"
composer install -d ${composerPathApp}

if [[ $SYNC_DB =~ ^[Yy]$ ]]
then
  echo -e "${blue}[INFO]${reset} Sync master database into local database"
  printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush sql:sync ${defaultSyncSystem} @self --create-db -y${reset}\n"
  drush sql:sync ${defaultSyncSystem} @self --create-db -y
fi

echo -e "${blue}[INFO]${reset} Drush magic"
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cache-rebuild${reset}\n"
drush cache-rebuild
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush updb -y${reset}\n"
drush updb -y
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cim -y${reset}\n"
drush cim -y
printf "${reset}${cyan}[DCC]${reset}${reset}<web> ${black}drush cache-rebuild${reset}\n"
drush cache-rebuild

echo
echo -e "${green}Drupal instance successfully resetted${reset}"
